model Cart {
  id          String     @id @default(uuid())
  customer_id String     @unique
  status      CartStatus @default(ACTIVE)
  expires_at  DateTime?
  customer    Customer   @relation(fields: [customer_id], references: [id], onDelete: Cascade)
  shop_carts  ShopCart[]

  @@index([customer_id])
  @@index([status])
  @@map("carts")
}

model ShopCart {
  id              String        @id @default(uuid())
  cart_id         String
  shop_id         String
  payment_method  PaymentMethod @default(CASH)
  post_order_type PostOrderType @default(DELIVERY_TO_TABLE)
  total_price     Float         @default(0)
  created_at      DateTime      @default(now())
  order_id        String?
  updated_at      DateTime
  note            String?
  items           CartItem[]
  cart            Cart          @relation(fields: [cart_id], references: [id], onDelete: Cascade)
  shop            Shop          @relation(fields: [shop_id], references: [id])

  @@index([cart_id])
  @@index([shop_id])
  @@map("shop_carts")
}

model CartItem {
  id               String               @id @default(nanoid())
  shop_cart_id     String
  product_id       String
  quantity         Int
  price_at_add     Float
  subtotal         Float
  note             String?
  product          Product              @relation(fields: [product_id], references: [id])
  shop_cart        ShopCart             @relation(fields: [shop_cart_id], references: [id], onDelete: Cascade)
  selected_options ProductOptionValue[] @relation("CartItemToProductOptionValue")

  @@index([shop_cart_id])
  @@index([product_id])
  @@map("cart_items")
}

enum CartStatus {
  ACTIVE
  CHECKED_OUT
  ABANDONED
  EXPIRED
  DELETED
}
