model Order {
  id                String         @id @default(uuid())
  created_at        DateTime       @default(now())
  updated_at        DateTime       @updatedAt
  customer_id       String
  shop_id           String
  estimation        Int?
  payment_proof_url String?
  processed_at      DateTime?
  rejected_reason   String?
  cancelled_reason  String?
  cancelled_by_id   String?
  total_price       Float
  status            OrderStatus
  type              OrderType      @default(READY)
  payment_method    PaymentMethod
  post_order_type   PostOrderType  @default(DELIVERY_TO_TABLE)
  table_number      Int?
  floor             Int?
  conversation_id   String
  note              String?
  order_items       OrderItem[]
  customer          Customer       @relation(fields: [customer_id], references: [id])
  shop              Shop           @relation(fields: [shop_id], references: [id])
  refund            Refund?
  complaint         ShopComplaint?
  testimony         ShopTestimony?

  @@index([shop_id, status])
  @@index([customer_id, status])
  @@index([shop_id, created_at])
  @@index([customer_id, created_at])
  @@index([status])
  @@map("orders")
}

model OrderItem {
  id               String               @id @default(nanoid())
  order_id         String
  product_id       String
  quantity         Int
  note             String?
  price_at_add     Float
  subtotal         Float
  order            Order                @relation(fields: [order_id], references: [id], onDelete: Cascade)
  product          Product              @relation(fields: [product_id], references: [id])
  refund_items     refund_items[]
  selected_options ProductOptionValue[] @relation("OrderItemToProductOptionValue")

  @@index([order_id])
  @@map("order_items")
}

enum OrderType {
  READY
  PREORDER
}

enum OrderStatus {
  PENDING_CONFIRMATION
  WAITING_PAYMENT
  WAITING_CUSTOMER_ESTIMATION_CONFIRMATION
  WAITING_SHOP_CONFIRMATION
  PROCESSING
  COMPLETED
  REJECTED
  PAYMENT_REJECTED
  CANCELLED
}

enum PostOrderType {
  DELIVERY_TO_TABLE
  TAKEAWAY
  COURIER_DELIVERY
}
