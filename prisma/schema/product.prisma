model Product {
  id             String            @id @default(cuid())
  created_at     DateTime          @default(now())
  updated_at     DateTime?         @updatedAt
  name           String
  description    String?
  image_url      String
  price          Float
  cost           Float?
  shop_id        String
  average_rating Float             @default(0)
  total_ratings  Int               @default(0)
  is_available   Boolean           @default(true)
  cart_items     CartItem[]
  order_items    OrderItem[]
  categories     ProductCategory[]
  options        ProductOption[]
  shop           Shop              @relation(fields: [shop_id], references: [id])

  @@index([name])
  @@index([shop_id])
  @@map("products")
}

model ProductOption {
  id          String               @id @default(nanoid())
  product_id  String
  option      String
  is_required Boolean              @default(false)
  type        ProductOptionType    @default(SINGLE)
  product     Product              @relation(fields: [product_id], references: [id], onDelete: Cascade)
  values      ProductOptionValue[]

  @@index([product_id])
  @@map("product_options")
}

model ProductOptionValue {
  id                String        @id @default(nanoid())
  value             String
  additional_price  Float?
  product_option_id String
  product_option    ProductOption @relation(fields: [product_option_id], references: [id], onDelete: Cascade)
  cart_items        CartItem[]    @relation("CartItemToProductOptionValue")
  order_items       OrderItem[]   @relation("OrderItemToProductOptionValue")

  @@map("product_options_values")
}

model Category {
  id        Int               @id @default(autoincrement())
  name      String            @unique
  slug      String            @unique
  image_url String
  products  ProductCategory[]

  @@map("categories")
}

model ProductCategory {
  product_id  String
  category_id Int
  category    Category @relation(fields: [category_id], references: [id], onDelete: Cascade)
  product     Product  @relation(fields: [product_id], references: [id], onDelete: Cascade)

  @@id([product_id, category_id])
  @@index([category_id])
  @@index([product_id])
  @@map("product_categories")
}

enum ProductOptionType {
  SINGLE
  MULTIPLE
}
