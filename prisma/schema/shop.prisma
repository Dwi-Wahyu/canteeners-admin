model Shop {
  id                       String                 @id @default(uuid())
  name                     String
  description              String?
  image_url                String
  canteen_id               Int
  status                   ShopStatus             @default(ACTIVE)
  suspended_reason         String?
  open_time                DateTime?
  close_time               DateTime?
  owner_id                 String                 @unique
  order_mode               ShopOrderMode          @default(READY_ONLY)
  refund_disbursement_mode RefundDisbursementMode @default(CASH)
  qrcode_url               String?
  minimum_price            Int?
  maximum_price            Int?
  average_rating           Float                  @default(0)
  total_ratings            Int                    @default(0)
  orders                   Order[]
  payments                 Payment[]
  products                 Product[]
  billings                 ShopBilling[]
  shop_carts               ShopCart[]
  canteen                  Canteen                @relation(fields: [canteen_id], references: [id])
  owner                    Owner                  @relation(fields: [owner_id], references: [id])

  @@index([canteen_id])
  @@index([name])
  @@map("shops")
}

model ShopBilling {
  id         String            @id @default(nanoid())
  shop_id    String
  start_date DateTime
  end_date   DateTime
  subtotal   Float
  refund     Float
  total      Float
  status     ShopBillingStatus @default(UNPAID)
  shop       Shop              @relation(fields: [shop_id], references: [id])

  @@map("shop_billings")
}

model ShopComplaint {
  id         String              @id @default(nanoid())
  created_at DateTime            @default(now())
  order_id   String              @unique
  proof_url  String?
  cause      String
  feedback   String?
  status     ShopComplaintStatus @default(PENDING)
  order      Order               @relation(fields: [order_id], references: [id], onDelete: Cascade)

  @@map("shop_complaints")
}

model Payment {
  method           PaymentMethod
  qr_url           String?
  account_number   String?
  note             String?
  additional_price Float?
  active           Boolean       @default(true)
  shop_id          String
  shop             Shop          @relation(fields: [shop_id], references: [id])

  @@unique([shop_id, method])
  @@map("payments")
}

enum ShopBillingStatus {
  PAID
  UNPAID
}

enum RefundDisbursementMode {
  CASH
  TRANSFER
}

enum ShopOrderMode {
  PREORDER_ONLY
  READY_ONLY
  BOTH
}

enum ShopStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum ShopComplaintStatus {
  PENDING
  UNDER_REVIEW
  RESOLVED
  REJECTED
  ESCALATED
}

enum PaymentMethod {
  QRIS
  BANK_TRANSFER
  CASH
}
