model User {
  id              String          @id @default(uuid())
  role            Role
  name            String
  username        String?         @unique
  password        String?
  avatar          String          @default("avatars/default-avatar.jpg")
  created_at      DateTime        @default(now())
  updated_at      DateTime        @updatedAt
  last_login      DateTime?
  admin           Admin?
  customer        Customer?
  owner           Owner?
  quick_chats     QuickChat[]
  user_fcm_tokens UserFCMTokens[]

  @@index([last_login])
  @@index([role])
  @@map("users")
}

model Admin {
  id      String @id @default(uuid())
  user_id String @unique
  user    User   @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("admins")
}

model Owner {
  id         String   @id @default(uuid())
  user_id    String   @unique
  updated_at DateTime @updatedAt
  user       User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  shop       Shop?

  @@map("owners")
}

model Customer {
  id             String              @id @default(uuid())
  user_id        String              @unique
  email          String?
  phone_number   String?
  suspend_until  DateTime?
  suspend_reason String?
  canteen_id     Int?
  floor          Int?
  table_number   Int?
  last_visit_at  DateTime?
  updated_at     DateTime            @updatedAt
  cart           Cart?
  violations     CustomerViolation[]
  user           User                @relation(fields: [user_id], references: [id], onDelete: Cascade)
  orders         Order[]

  @@map("customers")
}

enum Role {
  ADMIN
  CUSTOMER
  SHOP_OWNER
}

model UserFCMTokens {
  id           String      @id
  user_id      String
  token        String      @unique
  platform     FcmPlatform
  browser      String?
  is_active    Boolean     @default(true)
  last_used_at DateTime?
  created_at   DateTime    @default(now())
  updated_at   DateTime
  users        User        @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([platform])
  @@index([user_id])
}

enum FcmPlatform {
  WEB
  ANDROID
  IOS
}
